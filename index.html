<!DOCTYPE html>
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta property="og:title" content="Respiratory Case Simulator">
    <meta property="og:description" content="Interactive Case Simulator for Respiratory Conditions">
    <meta property="og:image" content="icon.png">
    <meta property="og:type" content="website">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to Respiratory Case Simulation </title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
        }

        body {
            font-family: 'Arial Rounded MT Bold', Arial, sans-serif;
            margin: 0;
            padding: 15px;
            background: #ecf0f1;
        }

        #game-container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            display: none;
        }

        #score-timer {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .progress-bar {
            height: 8px;
            background: #ddd;
            border-radius: 4px;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--success);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        #case-container {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            min-height: 200px;
        }

        #medication-pool {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            min-height: 120px;
        }

        .med-card {
            background: white;
            border: 2px solid var(--secondary);
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            touch-action: manipulation;
            user-select: none;
        }

        .med-card img {
            width: 60px;
            height: 60px;
            object-fit: contain;
            margin-bottom: 8px;
        }

        .med-card:hover, .med-card:active {
            transform: translateY(-3px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        #drop-zone {
            border: 2px dashed var(--success);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            min-height: 80px;
            background: rgba(39, 174, 96, 0.1);
            transition: all 0.3s ease;
        }

        .drag-over {
            background: rgba(52, 152, 219, 0.1) !important;
        }

        .feedback {
            text-align: center;
            padding: 12px;
            margin: 12px 0;
            border-radius: 5px;
            font-weight: bold;
            opacity: 0;
            transform: translateY(-15px);
            animation: fadeIn 0.4s forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; transform: translateY(0); }
        }

        .correct { background: #d4efdf; color: #145a32; }
        .wrong { background: #fadbd8; color: #78281f; }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            max-width: 90%;
            animation: modalIn 0.3s ease;
        }

        @keyframes modalIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .performance-badge {
            font-size: 1.3em;
            padding: 8px 16px;
            border-radius: 20px;
            margin: 12px 0;
        }

        .legendary { background: #f1c40f; color: #2c3e50; }
        .hero { background: #3498db; color: white; }
        .well-played { background: #2ecc71; color: white; }
        .try-again { background: #e74c3c; color: white; }

        #name-modal {
            display: flex;
        }

        #name-input-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        #submit-container {
            text-align: center;
            margin: 15px 0;
        }

        #submit-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1em;
            transition: transform 0.2s;
        }

        #submit-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            #medication-pool {
                grid-template-columns: 1fr;
            }
            
            .med-card {
                padding: 8px;
                margin: 4px 0;
            }
            
            #drop-zone {
                padding: 10px;
                min-height: 70px;
            }
            
            #submit-btn {
                padding: 12px 20px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="modal" id="name-modal">
        <div id="name-input-container">
            <h2>Welcome to Respiratory Case Simulation</h2>
            <input type="text" id="player-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ" style="padding: 8px; margin: 12px 0; width: 80%;">
            <br>
            <button onclick="startGameWithName()" style="padding: 10px 20px;">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
        </div>
    </div>

    <div id="game-container">
        <div id="score-timer">
            <div>Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span></div>
            <div>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="timer">60</span>Ø«Ø§Ù†ÙŠØ©</div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>

        <div id="case-container">
            <h2 id="patient-header">Ø´ÙƒÙˆÙ‰ Ø§Ù„Ø¹Ù…ÙŠÙ„</h2>
            <p id="symptoms"></p>
            <div id="drop-zone">Ø§Ø³Ø­Ø¨/Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ù‡Ù†Ø§</div>
        </div>

        <div id="submit-container">
            <button id="submit-btn" onclick="checkAnswer()" disabled>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</button>
        </div>

        <div id="medication-pool"></div>
        <div id="feedback" class="feedback"></div>
    </div>

    <div class="modal" id="endModal">
        <div class="modal-content">
            <h2>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!</h2>
            <div id="performanceBadge" class="performance-badge"></div>
            <p>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: <span id="finalScore">0</span></p>
            <p>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©: <span id="correctCount">0</span></p>
            <p>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø®Ø§Ø·Ø¦Ø©: <span id="wrongCount">0</span></p>
            <button onclick="location.reload()">Ø§Ù„Ø¹Ø¨ Ù…Ø¬Ø¯Ø¯Ù‹Ø§</button>
            <button onclick="closeModal()">Ø®Ø±ÙˆØ¬</button>
        </div>
    </div>

    <audio id="correctSound" src="correct.mp3"></audio>
    <audio id="wrongSound" src="wrong.mp3"></audio>

    <script>
        const cases = [
            {
                symptoms: "ÙŠØ§ Ø¯ÙƒØªÙˆØ± Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¨ØºÙ‰ Ø¯ÙˆØ§Ø¡ Ù„Ù„ÙƒØ­Ø© Ø¹Ù†Ø¯Ù‰ ÙƒØ­Ø© Ù…Ø±Ø© Ù…Ø¶Ø§ÙŠÙ‚Ø§Ù†Ù‰ ÙˆÙÙŠÙ‡Ø§ Ù…Ø®Ø§Ø· ÙˆØ¨Ù„ØºÙ… ",
                correctMeds: ["MUCINEX"],
                allowedMeds: [  
                    { name: "DEXTROCOUGH", image: "img/1.png" },
                    { name: "RIAPHAN", image: "img/2.jpg" },
                    { name: "MUCINEX", image: "img/3.jpg" }
                ],
                difficulty: 1
            },
            {
                symptoms: " ÙŠØ§ Ø¯ÙƒØªÙˆØ± Ù…Ù† Ø³Ø§Ø¹Ø© Ù…Ø§ Ø§Ù„ØµÙŠÙ Ø¯Ø®Ù„ ÙˆØ§Ù†Ø§ Ø¨Ø¹Ø§Ù†Ù‰ Ù…Ù† Ø±Ø´Ø­ ÙˆØ¹Ø·Ø§Ø³ Ø´Ø¯ÙŠØ¯ ÙˆØ­ØªÙ‰ Ø¹ÙŠÙ†Ù‰ Ù…Ø±Ø© ØªØ¯Ù…Ø¹ Ø¨Ø³ Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ Ù…Ø§ÙÙ‰ Ø­Ø±Ø§Ø±Ø© Ø§Ùˆ ØµØ¯Ø§Ø¹ ",
                correctMeds: ["LORIN", "TABUNEX", "SINOCLEAR"],
                allowedMeds: [
                    { name: "LORIN", image: "img/4.jpg" },
                    { name: "TABUNEX", image: "img/5.jpg" },
                    { name: "SINOCLEAR", image: "img/6.png" },
                    { name: "SAPOFEN", image: "img/7.png" }
                ],
                difficulty: 2
            },{
                symptoms: "ÙŠØ§ Ø¯ÙƒØªÙˆØ± Ù…Ù† ÙØ¶Ù„Ùƒ ÙƒÙ†Øª Ù…Ø­ØªØ§Ø¬ Ø­Ø§Ø¬Ø© ÙƒÙˆÙŠØ³Ø© Ù„Ù†Ø²Ù„Ø§Øª Ø§Ù„Ø¨Ø±Ø¯ Ø²Ù…ÙŠÙ„Ù‰ ÙÙ‰ Ø§Ù„Ø³ÙƒÙ† Ø¨Ù‚Ø§ÙŠØ© Ù…Ù† Ø§Ù…Ø¨Ø§Ø±Ø­ ØªØ¹Ø¨Ø§Ù† ÙˆØ¬Ø³Ù…Ø© Ù…ÙƒØ³Ø± ÙˆÙ…Ø­ØªØ§Ø¬ÙŠÙ† Ø­Ø§Ø¬Ø© ÙƒÙˆÙŠØ³Ø© Ù‡Ùˆ Ø³Ù†Ø© 27 ÙˆØ¹Ù†Ø¯Ø© Ø­Ø±Ø§Ø±Ø© ÙˆØ²ÙƒØ§Ù… ÙˆØ¬Ø³Ù…Ø© Ù…ÙƒØ³Ø± ÙˆØ¨ÙŠØªØ±Ø¹Ø´  ",
                correctMeds: ["DECOZAL", "BRUFEN", "LORIN"],
                allowedMeds: [
                    { name: "SOLPADEINE", image: "img/13.jpg" },
                    { name: "LORIN", image: "img/4.jpg" },
                    { name: "DECOZAL", image: "img/10.png" },
                    { name: "BRUFEN", image: "img/8.jpg" },
                    { name: "RIAPHAN", image: "img/2.jpg" }
                ],
                difficulty: 3
            }
        ];

        let currentCase = 0;
        let score = 0;
        let timeLeft = 60;
        let timerInterval;
        let correctCount = 0;
        let wrongCount = 0;
        let playerName = "";
        let selectedMeds = [];
        let draggedItem = null;

        function startGameWithName() {
            const nameInput = document.getElementById('player-name').value.trim();
            if (!nameInput) {
                alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ!");
                return;
            }
            playerName = nameInput;
            document.getElementById('name-modal').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            initGame();
        }

        function initGame() {
            loadCase(currentCase);
            startTimer();
            updateProgress();
        }

        // function loadCase(caseIndex) {
        //     const caseData = cases[caseIndex];
        //     document.getElementById("symptoms").textContent = caseData.symptoms;
            
        //     const medPool = document.getElementById("medication-pool");
        //     medPool.innerHTML = '';
            
        //     caseData.allowedMeds.forEach(med => {
        //         const card = document.createElement("div");
        //         card.className = "med-card";
        //         card.draggable = true;
        //         card.innerHTML = `
        //             <img src="${med.image}" alt="${med.name}">
        //             <div>${med.name}</div>
        //         `;
        //         //card.addEventListener("dragstart", dragStart);
        //         //card.addEventListener('click', handleMedicationClick);
        //         //card.addEventListener('touchstart', handleMedicationClick);
        //         card.addEventListener("dragstart", dragStart);
        //         card.addEventListener("click", handleMedicationClick); // desktop
        //         card.addEventListener("touchstart", handleMedicationTapStart); // mobile tap start
        //         card.addEventListener("touchend", handleMedicationTapEnd);     // mobile tap end

        //         medPool.appendChild(card);
        //     });
        // }

        function loadCase(caseIndex) {
    const caseData = cases[caseIndex];
    document.getElementById("symptoms").textContent = caseData.symptoms;

    const medPool = document.getElementById("medication-pool");
    medPool.innerHTML = '';

    caseData.allowedMeds.forEach(med => {
        const card = document.createElement("div");
        card.className = "med-card";
        card.draggable = true;
        card.innerHTML = `
            <img src="${med.image}" alt="${med.name}">
            <div>${med.name}</div>
        `;
        card.addEventListener("dragstart", dragStart);
        card.addEventListener("click", () => toggleMedicationSelection(card));
        medPool.appendChild(card);
    });
}


        function dragStart(e) {
            draggedItem = e.target.closest('.med-card');
            e.dataTransfer.setData("text/plain", draggedItem.querySelector("div").textContent);
        }

        // function handleMedicationClick(e) {
        //     const card = e.currentTarget;
        //     card.classList.add('mobile-tap-active');
        //     setTimeout(() => card.classList.remove('mobile-tap-active'), 200);
        //     toggleMedicationSelection(card);
        // }

//         function handleMedicationTapStart(e) {
//     e.currentTarget.dataset.touchStartY = e.touches[0].clientY;
//     e.currentTarget.dataset.touchStartX = e.touches[0].clientX;
// }

// function handleMedicationTapEnd(e) {
//     const card = e.currentTarget;
//     const startY = parseFloat(card.dataset.touchStartY);
//     const startX = parseFloat(card.dataset.touchStartX);
//     const endY = e.changedTouches[0].clientY;
//     const endX = e.changedTouches[0].clientX;

//     const dy = Math.abs(endY - startY);
//     const dx = Math.abs(endX - startX);

//     // Threshold to detect tap (not swipe or scroll)
//     if (dy < 10 && dx < 10) {
//         toggleMedicationSelection(card);
//     }
// }

        function toggleMedicationSelection(card) {
            const medication = card.querySelector("div").textContent;
            const dropZone = document.getElementById("drop-zone");
            const medPool = document.getElementById("medication-pool");

            if (card.parentElement === medPool) {
                if (!selectedMeds.includes(medication)) {
                    selectedMeds.push(medication);
                    dropZone.appendChild(card);
                }
            } else {
                const index = selectedMeds.indexOf(medication);
                if (index > -1) {
                    selectedMeds.splice(index, 1);
                    medPool.appendChild(card);
                }
            }
            updateSubmitButton();
        }

        
        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            const medication = draggedItem.querySelector("div").textContent;
            const dropZone = document.getElementById("drop-zone");
            const medPool = document.getElementById("medication-pool");

            if (draggedItem.parentElement === medPool) {
                if (!selectedMeds.includes(medication)) {
                    selectedMeds.push(medication);
                    dropZone.appendChild(draggedItem);
                }
            } else if (draggedItem.parentElement === dropZone) {
                const index = selectedMeds.indexOf(medication);
                if (index > -1) {
                    selectedMeds.splice(index, 1);
                    medPool.appendChild(draggedItem);
                }
            }
            updateSubmitButton();
        }

        function updateSubmitButton() {
            const submitBtn = document.getElementById('submit-btn');
            submitBtn.disabled = selectedMeds.length === 0;
        }

        function checkAnswer() {
            const correctMeds = cases[currentCase].correctMeds;
            const isCorrect = selectedMeds.length === correctMeds.length &&
                             correctMeds.every(med => selectedMeds.includes(med));

            const feedback = document.getElementById("feedback");
            feedback.textContent = isCorrect ? 
                `âœ“ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©ØŒ ${playerName}! Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨` : 
                `âœ— Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©ØŒ ${playerName}! Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰`;

            feedback.className = `feedback ${isCorrect ? 'correct' : 'wrong'}`;

            if (isCorrect) {
                playSound('correct');
                score += 100;
                correctCount++;
                proceedToNextCase();
            } else {
                playSound('wrong');
                wrongCount++;
                timeLeft = Math.max(0, timeLeft - 15);
                document.getElementById("timer").textContent = timeLeft;
                returnMedicationsToPool();
                
            }

            document.getElementById("score").textContent = score;
            selectedMeds = [];
            updateSubmitButton();
        }

        function returnMedicationsToPool() {
            const dropZone = document.getElementById("drop-zone");
            const medPool = document.getElementById("medication-pool");
            while (dropZone.firstChild) {
                medPool.appendChild(dropZone.firstChild);
            }
        }

        function startTimer() {
            timeLeft = 180;
            document.getElementById("timer").textContent = timeLeft;
            
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById("timer").textContent = timeLeft;
                
                if (timeLeft <= 0) handleTimeout();
            }, 1000);
        }

        function handleTimeout() {
            clearInterval(timerInterval);
            const feedback = document.getElementById("feedback");
            feedback.textContent = `â° Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚ØªØŒ ${playerName}! Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©...`;
            feedback.className = "feedback wrong";
            proceedToNextCase();
        }

        function proceedToNextCase() {
            setTimeout(() => {
                if (currentCase < cases.length - 1) {
                    currentCase++;
                    resetCase();
                } else {
                    endGame();
                }
            }, 2000);
        }

        function resetCase() {
            selectedMeds = [];
            returnMedicationsToPool();
            document.getElementById('submit-btn').disabled = true;
            loadCase(currentCase);
            startTimer();
            updateProgress();
            document.getElementById("feedback").textContent = "";
        }

        function updateProgress() {
            const progress = (currentCase / cases.length) * 100;
            document.querySelector(".progress-fill").style.width = `${progress}%`;
        }

        function endGame() {
            clearInterval(timerInterval);
            showFinalResults();
        }

        function showFinalResults() {
            const percentage = (correctCount / cases.length) * 100;
            const badge = document.getElementById("performanceBadge");
            
            let rating = '';
            if (percentage === 100) {
                rating = 'legendary';
                badge.textContent = 'ðŸ† Ø£Ø¯Ø§Ø¡ Ø£Ø³Ø·ÙˆØ±ÙŠ!';
            } else if (percentage >= 90) {
                rating = 'hero';
                badge.textContent = 'ðŸ¦¸ Ø¨Ø·Ù„!';
            } else if (percentage >= 70) {
                rating = 'well-played';
                badge.textContent = 'ðŸ‘ Ø£Ø­Ø³Ù†Øª!';
            } else {
                rating = 'try-again';
                badge.textContent = 'ðŸ’ª ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ­Ø³Ù†!';
            }
            
            badge.className = `performance-badge ${rating}`;
            document.getElementById("finalScore").textContent = `${score} (${playerName})`;
            document.getElementById("correctCount").textContent = correctCount;
            document.getElementById("wrongCount").textContent = wrongCount;
            document.getElementById("endModal").style.display = 'flex';
        }


        function restartGame() {
            currentCase = 0;
            score = 0;
            timeLeft = 60;
            correctCount = 0;
            wrongCount = 0;
            document.getElementById("score").textContent = '0';
            document.getElementById("timer").textContent = '60';
            document.querySelector(".progress-fill").style.width = '0%';
            document.getElementById("endModal").style.display = 'none';
            initGame();
        }

        function closeModal() {
            document.getElementById("endModal").style.display = 'none';
        }

        function playSound(type) {
            const sound = document.getElementById(`${type}Sound`);
            sound.currentTime = 0;
            sound.play();
        }
        
        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            const dropZone = document.getElementById("drop-zone");
            const medPool = document.getElementById("medication-pool");

            [dropZone, medPool].forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleDrop);
            });
        });
    </script>
</body>
</html>