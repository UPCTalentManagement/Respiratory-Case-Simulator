<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† - Ù…Ø­Ø§ÙƒÙŠ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªÙ†ÙØ³ÙŠØ©</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --primary: #1e3a5f;
            --secondary: #2196F3;
            --success: #4CAF50;
            --gold: #FFD700;
            --silver: #C0C0C0;
            --bronze: #CD7F32;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.15);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #66eae6 0%, #4b8ba2 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-lg);
            text-align: center;
        }

        .header h1 {
            color: var(--primary);
            font-size: 2.5em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow-lg);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-box:hover {
            transform: translateY(-5px);
        }

        .stat-box .icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .stat-box .label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .stat-box .value {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary);
        }

        .filters {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-lg);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filters label {
            font-weight: 600;
            color: var(--primary);
        }

        .filters select, .filters input {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .filters select:focus, .filters input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .refresh-btn {
            background: linear-gradient(135deg, var(--secondary), #1976d2);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: auto;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);
        }

        .leaderboard {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow-lg);
        }

        .leaderboard-header {
            font-size: 1.8em;
            color: var(--primary);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .podium {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 40px;
            align-items: end;
        }

        .podium-place {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            position: relative;
            transition: transform 0.3s ease;
        }

        .podium-place:hover {
            transform: scale(1.05);
        }

        .podium-place.first {
            order: 2;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            grid-row: 1;
        }

        .podium-place.second {
            order: 1;
            background: linear-gradient(135deg, #C0C0C0, #A8A8A8);
        }

        .podium-place.third {
            order: 3;
            background: linear-gradient(135deg, #CD7F32, #B8702E);
        }

        .podium-rank {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .podium-name {
            font-size: 1.3em;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .podium-score {
            font-size: 2em;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .podium-badge {
            background: rgba(255,255,255,0.3);
            padding: 5px 15px;
            border-radius: 20px;
            margin-top: 10px;
            display: inline-block;
            color: white;
            font-weight: 600;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 10px;
        }

        thead th {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px;
            text-align: right;
            font-weight: 600;
            font-size: 1.1em;
        }

        thead th:first-child {
            border-radius: 10px 0 0 10px;
        }

        thead th:last-child {
            border-radius: 0 10px 10px 0;
        }

        tbody tr {
            background: #f8f9fa;
            transition: all 0.3s ease;
        }

        tbody tr:hover {
            background: #e3f2fd;
            transform: scale(1.02);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        tbody td {
            padding: 15px;
            text-align: right;
        }

        tbody tr td:first-child {
            border-radius: 10px 0 0 10px;
            font-weight: bold;
            font-size: 1.2em;
        }

        tbody tr td:last-child {
            border-radius: 0 10px 10px 0;
        }

        .rank-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-weight: bold;
            color: white;
        }

        .rank-1 { background: linear-gradient(135deg, #FFD700, #FFA500); }
        .rank-2 { background: linear-gradient(135deg, #C0C0C0, #A8A8A8); }
        .rank-3 { background: linear-gradient(135deg, #CD7F32, #B8702E); }
        .rank-other { background: linear-gradient(135deg, #607d8b, #455a64); }

        .player-name {
            font-weight: 600;
            color: var(--primary);
            font-size: 1.1em;
        }

        .score-cell {
            font-size: 1.3em;
            font-weight: bold;
            color: var(--success);
        }

        .badge-cell {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .badge-Ø£Ø³Ø·ÙˆØ±ÙŠ {
            background: linear-gradient(135deg, #f1c40f, #f39c12);
            color: white;
        }

        .badge-Ø¨Ø·Ù„ {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .badge-Ø¬ÙŠØ¯ {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }

        .badge-Ù…Ø¨ØªØ¯Ø¦ {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .success-rate {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .success-bar {
            flex: 1;
            height: 8px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .success-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), #66bb6a);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: var(--primary);
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .no-data {
            text-align: center;
            padding: 60px;
            color: #666;
            font-size: 1.2em;
        }

        .timestamp {
            color: #999;
            font-size: 0.85em;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .podium {
                grid-template-columns: 1fr;
            }

            .podium-place.first,
            .podium-place.second,
            .podium-place.third {
                order: initial;
            }

            .filters {
                flex-direction: column;
                align-items: stretch;
            }

            .filters select,
            .filters input {
                width: 100%;
            }

            .refresh-btn {
                width: 100%;
            }

            table {
                font-size: 0.9em;
            }

            thead th,
            tbody td {
                padding: 10px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ† Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† ğŸ†</h1>
            <!-- <p>Ø£ÙØ¶Ù„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† </p> -->
        </div>

        <div class="stats-grid">
            <div class="stat-box">
                <div class="icon">ğŸ‘¥</div>
                <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</div>
                <div class="value" id="total-players">0</div>
            </div>
            <div class="stat-box">
                <div class="icon">ğŸ¯</div>
                <div class="label">Ø£Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø·</div>
                <div class="value" id="highest-score">0</div>
            </div>
            <div class="stat-box">
                <div class="icon">ğŸ“Š</div>
                <div class="label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ù‚Ø§Ø·</div>
                <div class="value" id="average-score">0</div>
            </div>
            <div class="stat-box">
                <div class="icon">â­</div>
                <div class="label">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­</div>
                <div class="value" id="average-success">0%</div>
            </div>
        </div>

        <div class="filters">
            <button class="refresh-btn" onclick="loadLeaderboard()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
            
            <label>Ø§Ù„Ø¨Ø­Ø«:</label>
            <input type="text" id="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù„Ø§Ø¹Ø¨..." onkeyup="filterTable()">
            
            <label>Ø§Ù„ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨:</label>
            <select id="sort-select" onchange="sortTable()">
                <option value="score">Ø§Ù„Ù†Ù‚Ø§Ø·</option>
                <option value="successRate">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­</option>
                <!-- <option value="timestamp">Ø§Ù„ØªØ§Ø±ÙŠØ®</option> -->
            </select>
            
            <!-- <label>Ø§Ù„Ø´Ø§Ø±Ø©:</label>
            <select id="badge-filter" onchange="filterTable()">
                <option value="all">Ø§Ù„ÙƒÙ„</option>
                <option value="Ø£Ø³Ø·ÙˆØ±ÙŠ">Ø£Ø³Ø·ÙˆØ±ÙŠ</option>
                <option value="Ø¨Ø·Ù„">Ø¨Ø·Ù„</option>
                <option value="Ø¬ÙŠØ¯">Ø¬ÙŠØ¯</option>
                <option value="Ù…Ø¨ØªØ¯Ø¦">Ù…Ø¨ØªØ¯Ø¦</option>
            </select> -->
        </div>

        <div class="leaderboard">
            <div class="leaderboard-header">
                ğŸ¥‡ Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ø«Ù„Ø§Ø«Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
            </div>
            
            <div class="podium" id="podium">
                <!-- Podium will be populated here -->
            </div>

            <div class="leaderboard-header" style="margin-top: 40px;">
                ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†
            </div>
            
            <div class="table-container">
                <div id="loading" class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
                <div id="no-data" class="no-data" style="display: none;">
                    <div style="font-size: 3em; margin-bottom: 20px;">ğŸ“Š</div>
                    Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹
                </div>
                <table id="leaderboard-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>Ø§Ù„ØªØ±ØªÙŠØ¨</th>
                            <th>Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨</th>
                            <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø®Ø§Ø·Ø¦Ø©</th>
                            <th>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­</th>
                            <!-- <th>Ø§Ù„Ø´Ø§Ø±Ø©</th>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th> -->
                        </tr>
                    </thead>
                    <tbody id="leaderboard-body">
                        <!-- Data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Replace with your actual Google Apps Script Web App URL
        const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbyFbTHtYbx8CrTe7cWe7NJqGUj0ZAIzm2PMOwXxwdiBLyprl91sd7vTHyohTUPT1gVUrQ/exec';
        
        let leaderboardData = [];

        async function loadLeaderboard() {
            const loading = document.getElementById('loading');
            const noData = document.getElementById('no-data');
            const table = document.getElementById('leaderboard-table');
            
            loading.style.display = 'block';
            noData.style.display = 'none';
            table.style.display = 'none';
            
            try {
                const response = await fetch(WEBAPP_URL);
                const result = await response.json();
                
                if (result.status === 'success' && result.data.length > 0) {
                    leaderboardData = result.data;
                    displayLeaderboard(leaderboardData);
                    updateStats(leaderboardData);
                    displayPodium(leaderboardData);
                    loading.style.display = 'none';
                    table.style.display = 'table';
                } else {
                    loading.style.display = 'none';
                    noData.style.display = 'block';
                    console.log(response)
                    console.log(result)
                }
            } catch (error) {
                console.error('Error loading leaderboard:', error);
                loading.style.display = 'none';
                noData.style.display = 'block';
            }
        }

        function displayPodium(data) {
            const podium = document.getElementById('podium');
            podium.innerHTML = '';
            
            const top3 = data.slice(0, 3);
            const positions = ['first','second',  'third'];
            const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
            
            top3.forEach((player, index) => {
                const place = document.createElement('div');
                place.className = `podium-place ${positions[index]}`;
                place.innerHTML = `
                    <div class="podium-rank">${medals[index]}</div>
                    <div class="podium-name">${player.playerName}</div>
                    <div class="podium-score">${player.score}</div>
                    <div class="podium-badge">${player.badge}</div>
                    <div style="color: white; margin-top: 10px; font-size: 0.9em;">
                        âœ“ ${player.correctCount} | âœ— ${player.wrongCount}
                    </div>
                `;
                podium.appendChild(place);
            });
            
            // If less than 3 players, add empty placeholders
            for (let i = top3.length; i < 3; i++) {
                const place = document.createElement('div');
                place.className = `podium-place ${positions[i]}`;
                place.innerHTML = `
                    <div class="podium-rank">${medals[i]}</div>
                    <div class="podium-name" style="color: rgba(255,255,255,0.5);">ÙØ§Ø±Øº</div>
                `;
                podium.appendChild(place);
            }
        }

        function displayLeaderboard(data) {
            const tbody = document.getElementById('leaderboard-body');
            tbody.innerHTML = '';
            
            data.forEach((player, index) => {
                const rank = index + 1;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <span class="rank-badge rank-${rank <= 3 ? rank : 'other'}">
                            ${rank}
                        </span>
                    </td>
                    <td class="player-name">${player.playerName}</td>
                    <td class="score-cell">${player.score}</td>
                    <td style="color: #27ae60;">âœ“ ${player.correctCount}</td>
                    <td style="color: #e74c3c;">âœ— ${player.wrongCount}</td>
                    <td>
                        <div class="success-rate">
                            <div class="success-bar">
                                <div class="success-fill" style="width: ${player.successRate}%"></div>
                            </div>
                            <span style="font-weight: bold;">${player.successRate}%</span>
                        </div>
                    </td>
                    
                `;
                tbody.appendChild(row);
            });
        }

        function updateStats(data) {
            document.getElementById('total-players').textContent = data.length;
            
            const scores = data.map(p => p.score);
            document.getElementById('highest-score').textContent = Math.max(...scores);
            
            const avgScore = Math.round(scores.reduce((a, b) => a + b, 0) / scores.length);
            document.getElementById('average-score').textContent = avgScore;
            
            const avgSuccess = Math.round(data.reduce((sum, p) => sum + p.successRate, 0) / data.length);
            document.getElementById('average-success').textContent = avgSuccess + '%';
        }






        function formatDate(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 60) {
                return `Ù…Ù†Ø° ${diffMins} Ø¯Ù‚ÙŠÙ‚Ø©`;
            } else if (diffHours < 24) {
                return `Ù…Ù†Ø° ${diffHours} Ø³Ø§Ø¹Ø©`;
            } else if (diffDays < 7) {
                return `Ù…Ù†Ø° ${diffDays} ÙŠÙˆÙ…`;
            } else {
                return date.toLocaleDateString('ar-EG');
            }
        }

        function filterTable() {
            const searchValue = document.getElementById('search-input').value.toLowerCase();
            const badgeFilter = document.getElementById('badge-filter').value;
            
            const filtered = leaderboardData.filter(player => {
                const matchesName = player.playerName.toLowerCase().includes(searchValue);
                const matchesBadge = badgeFilter === 'all' || player.badge === badgeFilter;
                return matchesName && matchesBadge;
            });
            displayLeaderboard(filtered);
        }

        function sortTable() {
            const sortBy = document.getElementById('sort-select').value;
            const sorted = [...leaderboardData].sort((a, b) => {
                if (sortBy === 'timestamp') return new Date(b.timestamp) - new Date(a.timestamp);
                return b[sortBy] - a[sortBy];
            });
            displayLeaderboard(sorted);
        }

        function assignBadges(data) {
            return data.map(player => {
                if (player.score >= 90) player.badge = 'Ø£Ø³Ø·ÙˆØ±ÙŠ';
                else if (player.score >= 75) player.badge = 'Ø¨Ø·Ù„';
                else if (player.score >= 60) player.badge = 'Ø¬ÙŠØ¯';
                else player.badge = 'Ù…Ø¨ØªØ¯Ø¦';
                return player;
            });
        }

        window.onload = loadLeaderboard;
    </script>

</body>
</html>